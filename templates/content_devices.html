<?php
$lab = '';
$loc = '';
$dev = '';
$labid = '';

if (isset($_GET['lab'])) {
    $lab = $_GET['lab'];
}
if (isset($_GET['loc'])) {
    $loc = $_GET['loc'];
}
if (isset($_GET['id'])) {
    $labid = $_GET['id'];
}
if (isset($_GET['dev'])) {
    $dev = $_GET['dev'];
}

if (empty($lab) and empty($loc) and empty($dev) and empty($labid)) {
    echo '
<!-- Page Content -->
<div id="page-wrapper">

    <!-- Modal -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                    <h4 class="modal-title" id="myModalLabel">Modal title</h4>
                </div>
                <div class="modal-body">
                    ...
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="row">
        <div class="col-lg-12">
            <h1 class="page-header">Devices</h1>
        </div>
        <!-- /.col-lg-12 -->
    </div>
    <!-- /.row -->
    <div class="row">
        <div class="col-lg-4">
            <div class="panel panel-red">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                            <i class="fa fa-server fa-5x"></i>
                        </div>
                        <div class="col-xs-9 text-right">
                            <div class="huge">'. $total_devices . '</div>
                            <div>Devices</div>
                        </div>
                    </div>
                </div>
                <a href="devices.php">
                    <div class="panel-footer">
                        <span class="pull-left">View Details</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>

                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
        <div class="col-lg-4">
            <div class="panel panel-default">
                <div class="panel-heading">
                    <div class="row">
                        <div class="col-xs-3">
                            <i class="fa fa-server fa-5x"></i>
                        </div>
                        <div class="col-xs-9 text-right">
                            <div class="huge">Add Device</div>
                            <div>Add a new Device</div>
                        </div>
                    </div>
                </div>
                <a href="#myModal" data-toggle="modal">
                    <div class="panel-footer">
                        <span class="pull-left">Add</span>
                        <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>
                        <div class="clearfix"></div>
                    </div>
                </a>
            </div>
        </div>
        ';
        } else {
        echo '
        <!-- Page Content -->
        <div id="page-wrapper">
            <div class="row">
                <div class="col-lg-12">';
                    if ($labid) {
                        echo '<h1 class="page-header">Device - ' . ucwords($dev) . ' - ' . $loc . '</h1>';
                    } else {
                        echo '<h1 class="page-header">Devices - ' . ucwords($dev) . '</h1>';
                    }
                    echo '
                </div>
                <!-- /.col-lg-12 -->
            </div>
            <!-- /.row -->
            <div class="row">
                <div class="col-lg-4">
                    <div class="panel panel-primary">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-building fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">';
                                    if ($loc) {
                                        echo '<div class="huge">'. $db->getCountIDAnd('devices', 'type', $lab,
                                            'location', $loc) .'</div>';
                                    } else {
                                        echo '<div class="huge">'. $db->getCountGroupRows('devices', 'type', $lab, 'locid') .'</div>';
                                    }
                                    echo '
                                    <div>Locations</div>
                                </div>
                            </div>
                        </div>
                        <a href="locations.php">
                            <div class="panel-footer">
                                <span class="pull-left">View Details</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>

                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="panel panel-yellow">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-cube fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">';
                                    if ($loc) {
                                        echo '<div class="huge">'. $db->getCountIDAnd('racks', 'category', $lab, 'location',
                                        $loc) .'</div>';
                                    } else {
                                        echo '<div class="huge">'. $db->getCountID('racks', 'category', $lab) .'</div>';
                                    }
                                    echo '
                                    <div>Racks</div>
                                </div>
                            </div>
                        </div>
                        <a href="racks.php">
                            <div class="panel-footer">
                                <span class="pull-left">View Details</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>

                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
                <div class="col-lg-4">
                    <div class="panel panel-red">
                        <div class="panel-heading">
                            <div class="row">
                                <div class="col-xs-3">
                                    <i class="fa fa-server fa-5x"></i>
                                </div>
                                <div class="col-xs-9 text-right">';
                                    if ($loc) {
                                        echo '<div class="huge">'. $db->getCountIDAnd('devices', 'category', $lab,
                                        'location', $loc) .'</div>';
                                    } else {
                                        echo '<div class="huge">'. $db->getCountID('devices', 'category', $lab) .'</div>';
                                    }
                                    echo '
                                    <div>Devices</div>
                                </div>
                            </div>
                        </div>
                        <a href="devices.php">
                            <div class="panel-footer">
                                <span class="pull-left">View Details</span>
                                <span class="pull-right"><i class="fa fa-arrow-circle-right"></i></span>

                                <div class="clearfix"></div>
                            </div>
                        </a>
                    </div>
                </div>
                ';
                }
                ?>
            </div>
            <div class="row">

                <?php
                if (empty($dev)) {
                    echo '
                <div class="col-lg-4">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <i class="fa fa-sitemap fa-fw"></i> Labs
                        <div class="pull-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-default btn-xs dropdown-toggle"
                                        data-toggle="dropdown" aria-expanded="false">
                                    Actions
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu pull-right" role="menu">
                                    <li><a href="#myModal" data-toggle="modal">Add <i class="fa fa-plus fa-fw"></i> (<i
                                            class="fa fa-sitemap fa-fw"></i>)</a>
                                    </li>
                                    <li class="divider"></li>
                                    <li><a href="#">Details</a>
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-lg-4">
                                <ul class="list-unstyled">
                                ';
                                $list = $db->query('SELECT id, name, lab, rack, location FROM devices ORDER by locid');
                                while ($row = $list->fetchArray()) {
                                echo '
                                <li>
                                    <a
                                            href="devices.php?dev=' . $row['name'] . '&lab=' . $row['lab'] . '&loc=' . $row['location'] . '&rack=' . $row['rack'] . '&id=' . $row['id'] . '"><i
                                            class="fa fa-sitemap fa-fw"></i> ' . $row['name'] . '</a>
                                </li>
                                ';
                                }
                                echo '
                                </ul>
                            </div>
                            <div class="col-lg-4">
                                <ul class="list-unstyled">
                                    ';
                                    $list = $db->query('SELECT rack FROM devices ORDER BY locid');
                                    while ($row = $list->fetchArray()) {
                                    echo '
                                    <li>
                                        <i class="fa fa-cube fa-fw"></i> ' . $row['rack'] . '
                                    </li>
                                    ';
                                    }
                                    echo '
                                </ul>
                            </div>
                            <div class="col-lg-4">
                                <ul class="list-unstyled">
                                    ';
                                    $list = $db->query('SELECT location FROM devices ORDER BY locid');
                                    while ($row = $list->fetchArray()) {
                                    echo '
                                    <li>
                                        <i class="fa fa-building fa-fw"></i> ' . $row['location'] . '
                                    </li>
                                    ';
                                    }
                                    echo '
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            ';
            } else {
            echo '
            <div class="col-lg-4">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <i class="fa fa-cube fa-fw"></i> Locations
                        <div class="pull-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-default btn-xs dropdown-toggle"
                                        data-toggle="dropdown" aria-expanded="false">
                                    Actions
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu pull-right" role="menu">
                                    ';
                                    $list = $db->query('SELECT id FROM labs WHERE category="' . $lab .
                                    '" GROUP BY category');
                                    while ($row = $list->fetchArray()) {
                                    echo '<li>';
                                        if ($loc) {
                                            echo '
                                        <a
                                                href="labs.php?lab=' . $row['lab'] . '&loc=' . $loc . '&action=add">Add <i class="fa fa-plus fa-fw"></i> (<i
                                                class="fa fa-sitemap fa-fw"></i> ' . $row['lab'] . ')</a>';
                                        } else {
                                            echo '
                                        <a
                                                href="labs.php?lab=' . $lab . '&action=add">Add <i class="fa fa-plus fa-fw"></i> (<i
                                                class="fa fa-sitemap fa-fw"></i> ' . ucwords($lab) . ')</a>';
                                        }
                                    echo '</li>';
                                    }
                                    echo '
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-lg-4">
                                <ul class="list-unstyled">
                                    ';
                                    $list = $db->query('SELECT id, location, name FROM labs WHERE category="' . $lab .
                                    '" ORDER BY locid');
                                    while ($row = $list->fetchArray()) {
                                    echo '
                                    <li>
                                        <a
                                                href="labs.php?lab=' . $lab . '&loc=' . $row['location'] . '&id=' . $row['id'] . '"><i
                                                class="fa fa-sitemap fa-fw"></i> ' . $row['name'] . '</a>
                                    </li>
                                    ';
                                    }
                                    echo '
                                </ul>
                            </div>
                            <div class="col-lg-4">
                                <ul class="list-unstyled">
                                    ';
                                    $list = $db->query('SELECT location FROM labs WHERE category="' . $lab .
                                    '" ORDER BY locid');
                                    while ($row = $list->fetchArray()) {
                                    echo '
                                    <li>
                                        <i class="fa fa-building fa-fw"></i> ' . $row['location'] . '
                                    </li>
                                    ';
                                    }
                                    echo '
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            ';

            echo '
            <div class="col-lg-4">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <i class="fa fa-cube fa-fw"></i> Racks
                        <div class="pull-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-default btn-xs dropdown-toggle"
                                        data-toggle="dropdown" aria-expanded="false">
                                    Actions
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu pull-right" role="menu">
                                    ';
                                    $list = $db->query('SELECT location FROM racks WHERE category="' . $lab .
                                    '" GROUP BY location');
                                    while ($row = $list->fetchArray()) {
                                    echo '
                                    <li><a
                                            href="racks.php?lab=' . $lab . '&loc=' . $row['location'] . '&action=add">Add <i class="fa fa-plus fa-fw"></i> (<i
                                            class="fa fa-building fa-fw"></i> ' . $row['location'] . ')</a>
                                    </li>
                                    ';
                                    }
                                    echo '
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-lg-4">
                                <ul class="list-unstyled">
                                ';
                                $list = $db->query('SELECT name, location FROM racks WHERE category="' . $lab .
                                '" ORDER BY locid');
                                while ($row = $list->fetchArray()) {
                                echo '
                                <li>
                                    <a
                                            href="racks.php?rack=' . $row['name'] . '&lab=' . $lab . '&loc=' . $row['location'] . '"><i
                                            class="fa fa-cube fa-fw"></i> ' . $row['name'] . '</a>
                                </li>
                                ';
                                }
                                echo '
                                </ul>
                            </div>
                            <div class="col-lg-4">
                                <ul class="list-unstyled">
                                    ';
                                    $list = $db->query('SELECT location FROM racks WHERE category="' . $lab .
                                    '" ORDER BY locid');
                                    while ($row = $list->fetchArray()) {
                                    echo '
                                    <li>
                                        <i class="fa fa-building fa-fw"></i> ' . $row['location'] . '
                                    </li>
                                    ';
                                    }
                                    echo '
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            ';

            echo '
            <div class="col-lg-4">
                <div class="panel panel-default">
                    <div class="panel-heading">
                        <i class="fa fa-server fa-fw"></i> Devices
                        <div class="pull-right">
                            <div class="btn-group">
                                <button type="button" class="btn btn-default btn-xs dropdown-toggle"
                                        data-toggle="dropdown" aria-expanded="false">
                                    Actions
                                    <span class="caret"></span>
                                </button>
                                <ul class="dropdown-menu pull-right" role="menu">
                                    ';
                                    $list = $db->query('SELECT rack, location FROM devices WHERE category="' .
                                    $lab . '" GROUP BY location');
                                    while ($row = $list->fetchArray()) {
                                    echo '
                                    <li><a
                                            href="devices.php?rack=' . $row['rack'] . '&lab=' . $lab . '&loc=' . $row['location'] . '&action=add">Add <i class="fa fa-plus fa-fw"></i> (<i
                                            class="fa fa-cube fa-fw"></i> ' . $row['rack'] . ' - <i
                                            class="fa fa-sitemap fa-fw"></i> ' . $row['location']
                                        . ')</a>
                                    </li>
                                    ';
                                    }
                                    echo '
                                </ul>
                            </div>
                        </div>
                    </div>
                    <div class="panel-body">
                        <div class="row">
                            <div class="col-lg-4">
                                <ul class="list-unstyled">
                                ';
                                $list = $db->query('SELECT name, location, rack FROM devices WHERE category="' .
                                $lab . '" ORDER BY locid');
                                while ($row = $list->fetchArray()) {
                                echo '
                                <li>
                                    <a
                                            href="devices.php?dev=' . $row['name'] . '&rack=' . $row['rack'] . '&lab=' . $lab . '&loc=' . $row['location'] . '"><i
                                            class="fa fa-server fa-fw"></i> ' . $row['name'] . '</a>
                                </li>
                                ';
                                }
                                echo '
                                </ul>
                            </div>
                            <div class="col-lg-4">
                                <ul class="list-unstyled">
                                    ';
                                    $list = $db->query('SELECT rack FROM devices WHERE category="' .
                                    $lab . '" ORDER BY locid');
                                    while ($row = $list->fetchArray()) {
                                    echo '
                                    <li>
                                        <i class="fa fa-cube fa-fw"></i> ' . $row['rack'] . '
                                    </li>
                                    ';
                                    }
                                    echo '
                                </ul>
                            </div>
                            <div class="col-lg-4">
                                <ul class="list-unstyled">
                                    ';
                                    if ($labid) {
                                        $list = $db->query('SELECT location FROM devices WHERE lab="' .
                                        $lab . '" ORDER BY locid');
                                    } else {
                                        $list = $db->query('SELECT location FROM devices WHERE category="' .
                                        $lab . '" ORDER BY locid');
                                    }
                                    while ($row = $list->fetchArray()) {
                                    echo '
                                    <li>
                                        <i class="fa fa-building fa-fw"></i> ' . $row['location'] . '
                                    </li>
                                    ';
                                    }
                                    echo '
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            ';
            }
            ?>

            <!-- /.col-lg-12 -->
        </div>
        <!-- /.row -->
    </div>
    <!-- /#page-wrapper -->
